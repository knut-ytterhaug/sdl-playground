#include <stdio.h>
#include <SDL/SDL.h>
#include <math.h>
#define X 1600
#define Y 1200

void putpixel(SDL_Surface *screen, int y, int x, int r, int g, int b)
{
	Uint16 pixel;
	Uint8 *p;

	if(x >= X)
	{
		x = x - X;
	}
	if(!(y > Y || y < 0 || x < 0))
	{
		pixel = SDL_MapRGB(screen->format, r, g, b);
		p = (Uint8 *)screen->pixels + y * screen->pitch + x * 4;
		*(Uint32 *)p = pixel;
	}
}

void clearscreen(SDL_Surface *screen)
{
	int x, y;
	Uint16 pixel;
	Uint8 *p;

	for(y = 0; y < Y; y++)
	{
		for(x = 0; x < X; x++)
		{
			pixel = SDL_MapRGB(screen->format, 0, 0, 0); 
			p = (Uint8 *)screen->pixels + y * screen->pitch + x * 4;
			*(Uint32 *)p = pixel;
		}
	}
}

int main(int argc, char *argv[])
{
	SDL_Surface *screen;

	int i, x, y;
	int tmpcharset[26][5][5] = {	
							/* A */
						{	{0,1,1,1,0},
							{1,0,0,0,1},
							{1,1,1,1,1},
							{1,0,0,0,1},
							{1,0,0,0,1}	},
							/* B */
						{	{1,1,1,1,0},
							{1,0,0,0,1},
							{1,1,1,1,0},
							{1,0,0,0,1},
							{1,1,1,1,0} },
							/* C */
						{	{0,1,1,1,1},
							{1,0,0,0,0},
							{1,0,0,0,0},
							{1,0,0,0,0},
							{0,1,1,1,1}	},
							/* D */
						{	{1,1,1,1,0},
							{1,0,0,0,1},
							{1,0,0,0,1},
							{1,0,0,0,1},
							{1,1,1,1,0} },
							/* E */
						{	{1,1,1,1,1},
							{1,0,0,0,0},
							{1,1,1,1,0},
							{1,0,0,0,0},
							{1,1,1,1,1} },
							/* F */
						{	{1,1,1,1,1},
							{1,0,0,0,0},
							{1,1,1,1,0},
							{1,0,0,0,0},
							{1,0,0,0,0} },
							/* G */
						{	{0,1,1,1,0},
							{1,0,0,0,0},
							{1,0,0,1,1},
							{1,0,0,0,1},
							{0,1,1,1,0} },
							/* H */
						{	{1,0,0,0,1},
							{1,0,0,0,1},
							{1,1,1,1,1},
							{1,0,0,0,1},
							{1,0,0,0,1} },
							/* I */
						{	{0,0,1,0,0},
							{0,0,1,0,0},
							{0,0,1,0,0},
							{0,0,1,0,0},
							{0,0,1,0,0} },
							/* J */
						{	{0,0,0,0,1},
							{0,0,0,0,1},
							{0,0,0,0,1},
							{1,0,0,0,1},
							{0,1,1,1,0} },
							/* K */
						{	{1,0,0,0,1},
							{1,0,0,1,0},
							{1,1,1,0,0},
							{1,0,0,1,0},
							{1,0,0,0,1} },
							/* L */
						{	{1,0,0,0,0},
							{1,0,0,0,0},
							{1,0,0,0,0},
							{1,0,0,0,0},
							{1,1,1,1,1} },
							/* M */
						{	{1,0,0,0,1},
							{1,1,0,1,1},
							{1,0,1,0,1},
							{1,0,0,0,1},
							{1,0,0,0,1} },
							/* N */
						{	{1,0,0,0,1},
							{1,1,0,0,1},
							{1,0,1,0,1},
							{1,0,0,1,1},
							{1,0,0,0,1} },
							/* O */
						{	{0,1,1,1,0},
							{1,0,0,0,1},
							{1,0,0,0,1},
							{1,0,0,0,1},
							{0,1,1,1,0} },
							/* P */
						{	{1,1,1,1,0},
							{1,0,0,0,1},
							{1,1,1,1,0},
							{1,0,0,0,0},
							{1,0,0,0,0} },
							/* Q */
						{	{0,1,1,1,0},
							{1,0,0,0,1},
							{1,0,0,0,1},
							{1,0,0,1,1},
							{0,1,1,1,1} },
							/* R */
						{	{1,1,1,1,0},
							{1,0,0,0,1},
							{1,1,1,1,0},
							{1,0,0,1,0},
							{1,0,0,0,1} },
							/* S */
						{	{0,1,1,1,0},
							{1,0,0,0,0},
							{0,1,1,1,0},
							{0,0,0,0,1},
							{0,1,1,1,0} },
							/* T */
						{	{1,1,1,1,1},
							{0,0,1,0,0},
							{0,0,1,0,0},
							{0,0,1,0,0},
							{0,0,1,0,0} },
							/* U */
						{	{1,0,0,0,1},
							{1,0,0,0,1},
							{1,0,0,0,1},
							{1,0,0,0,1},
							{0,1,1,1,0} },
							/* V */
						{	{1,0,0,0,1},
							{1,0,0,0,1},
							{1,0,0,0,1},
							{0,1,0,1,0},
							{0,0,1,0,0} },
							/* W */
						{	{1,0,0,0,1},
							{1,0,0,0,1},
							{1,0,1,0,1},
							{1,1,0,1,1},
							{1,0,0,0,1} },
							/* X */
						{	{1,0,0,0,1},
							{0,1,0,1,0},
							{0,0,1,0,0},
							{0,1,0,1,0},
							{1,0,0,0,1} },
							/* Y */
						{	{1,0,0,0,1},
							{0,1,0,1,0},
							{0,0,1,0,0},
							{0,0,1,0,0},
							{0,0,1,0,0} },
							/* Z */
						{	{1,1,1,1,1},
							{0,0,0,1,0},
							{0,0,1,0,0},
							{0,1,0,0,0},
							{1,1,1,1,1} }
	};

	int charset[256][5][5] = { { { 0,1,0,0,0}}};

	for(i = 0; i < 26; i++)
	{
		for(y = 0; y < 5; y++)
		{
			for(x = 0; x < 5; x++)
			{
				charset[i+65][y][x] = tmpcharset[i][y][x];
				charset[i+97][y][x] = tmpcharset[i][y][x];
			}
		}
	}

	char *test = "gard is evil";

	SDL_Init(SDL_INIT_VIDEO);
	SDL_EventState(SDL_ACTIVEEVENT, SDL_IGNORE);
	SDL_EventState(SDL_MOUSEMOTION, SDL_IGNORE);

	screen = SDL_SetVideoMode(X, Y, 32, SDL_SWSURFACE);
	
	unsigned char a;
	int b;

	while(SDL_PollEvent(NULL) == 0)
	{
        SDL_Delay(10);
		b++;
		if(b == X)
			b = 0;
		a++;
		for(i = 0; i < strlen(test); i++)
		{
			for(y = 0; y < 5; y++)
			{
				for(x = 0; x < 5; x++)
				{
					if(charset[test[i]][y][x] == 1)
					{
						putpixel(screen, y+((sin(((a+(i*3))/(256/360.0))*M_PI/180)*-200)*0.5+(Y/2)), (x+(i*6))+b, 0, 0, 255);
					}
				}
			}
		}
		SDL_Flip(screen);
		for(i = 0; i < strlen(test); i++)
		{
			for(y = 0; y < 5; y++)
			{
				for(x = 0; x < 5; x++)
				{
					if(charset[test[i]][y][x] == 1)
					{
						putpixel(screen, y+((sin(((a+(i*3))/(256/360.0))*M_PI/180)*-200)*0.5+(Y/2)), (x+(i*6))+b, 0, 0, 0);
					}
				}
			}
		}
	}

	while(SDL_PollEvent(NULL) == 0)
	{
		SDL_Flip(screen);
	}

	return 0;
}
